(function(a){a.fn.extend({spectralGradientGenerator:function(b){var d={gradientBoxWidth:500,gradientBoxHeight:20,targetTextArea:""};var b=a.extend(d,b);jQuery.fn.sortElements=function(){var e=[].sort;return function(f,h){h=h||function(){return this};var g=this.map(function(){var j=h.call(this),i=j.parentNode,k=i.insertBefore(document.createTextNode(""),j.nextSibling);return function(){if(i===this){throw new Error("You can't sort elements if any one is a descendant of another.")}i.insertBefore(this,k);i.removeChild(k)}});return e.call(this,f).each(function(i){g[i].call(h.call(this))})}}();function c(e){e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function f(g){return("0"+parseInt(g).toString(16)).slice(-2)}return"#"+f(e[1])+f(e[2])+f(e[3])}return this.each(function(){var f=b;widthRatio=f.gradientBoxWidth/100;a(this).css({position:"relative",width:f.gradientBoxWidth,height:f.gradientBoxHeight,border:"1px solid #000",textAlign:"center",cursor:"crosshair"});a(this).append('<div class="spectral"><div class="spectrumbox-gradient"></div><div class="gradient-stop-control-area"><ul><li class="gradient-stop ui-draggable" data-id="0" id="gradient-stop-0"><div class="gradient-stop-color"></div><a class="gradient-stop-pos"></a><div class="gradient-stop-pos-form"><input class="gradient-stop-pos-input" type="text" value="0" /><a class="gobutton">go <span class="ui-icon ui-icon-arrowthick-2-e-w"></span></a><a class="closebutton">&times;</a></div><span class="gradient-stop-icon ui-icon ui-icon-triangle-2-e-w"></span></li><li class="gradient-stop gradient-stop-2 ui-draggable" data-id="1" id="gradient-stop-1"><div class="gradient-stop-color"></div><a class="gradient-stop-pos"></a><div class="gradient-stop-pos-form"><input class="gradient-stop-pos-input" type="text" value="0" /><a class="gobutton">go <span class="ui-icon ui-icon-arrowthick-2-e-w"></span></a><a class="closebutton">&times;</a></div><span class="gradient-stop-icon ui-icon ui-icon-triangle-2-e-w"></span></li></ul></div></div><div id="spectral-cssplaceholder">');a(this).resizable({maxWidth:f.gradientBoxWidth,minWidth:f.gradientBoxWidth,minHeight:f.gradientBoxHeight});a(".spectral .gradient-stop-control-area").css("width",f.gradientBoxWidth+26);jQuery(document).on("click",".gradient-stop",function(){a(this).siblings().find(".gradient-stop-pos-form").hide()});jQuery(document).on("click",".gradient-stop-pos",function(){a(this).siblings(".gradient-stop-pos-form").show()});jQuery(document).on("click",".gradient-stop-pos-form .closebutton",function(){a(this).parent().hide()});jQuery(document).on("click",".gobutton",function(){var i=parseInt(a(this).siblings(".gradient-stop-pos-input").val());if(i>=0&&i<=100){a(this).parent().parent().css("left",i*widthRatio)}else{a(this).effect("highlight")}a(this).parent().siblings(".gradient-stop-pos").html(i)});jQuery(document).on("keypress",".gradient-stop-pos-input",function(j){if(j.which==13){var i=parseInt(a(this).val());if(i>=0&&i<=100){a(this).parent().parent().css("left",i*widthRatio)}else{a(this).effect("highlight")}a(this).parent().siblings(".gradient-stop-pos").html(i);h()}});jQuery(document).on("keyup",".gradient-stop-pos-input",function(){var k=parseInt(a(this).val());var j=parseInt(a(this).parent().siblings(".gradient-stop-pos").html());var i=a(this).siblings().children("span");i.removeClass();if(k==j){i.addClass("ui-icon ui-icon-arrowthick-2-e-w")}else{if(k>=0&&k<j){i.addClass("ui-icon ui-icon-arrowthickstop-1-w")}else{if(k<=100&&k>j){i.addClass("ui-icon ui-icon-arrowthickstop-1-e")}else{i.addClass("ui-icon ui-icon-alert");a(this).effect("highlight")}}}});jQuery(document).on("dragcreate",".gradient-stop",function(){a(this).children(".gradient-stop-pos").html(Math.ceil(a(this).position().left/widthRatio));a(this).find(".gradient-stop-pos-input").val(Math.ceil(a(this).position().left/widthRatio));h()});jQuery(document).on("hover",".gradient-stop-color",function(){var i=a(this);i.ColorPicker({color:c(i.css("background-color")),onShow:function(j){a(j).fadeIn(500);return false},onHide:function(j){a(j).fadeOut(500);return false},onChange:function(j,l,k){i.css("backgroundColor","#"+l);h()}})});var e={axis:"x",containment:"parent",drag:function(j,l){a(this).children(".gradient-stop-pos").html(Math.ceil(l.position.left/widthRatio));a(this).find(".gradient-stop-pos-input").val(Math.ceil(l.position.left/widthRatio));var i=a(this).offset();var m=j.pageX-i.left;var k=j.pageY-i.top;a("#placeholder").html("relX: "+m+"   relY: "+k);if(k>70&&a(".gradient-stop").length>2){a(this).css("opacity",0.75);if(k>80){a(this).css("opacity",0.5)}if(k>90){a(this).css("opacity",0.25)}if(k>100){a(this).remove();h()}}else{a(this).css("opacity",1)}h()},stop:function(j,l){var i=a(this).offset();var m=j.pageX-i.left;var k=j.pageY-i.top;a("#placeholder").html("relX: "+m+"   relY: "+k);if(k<100){a(this).css("opacity",1);if(k>100){a(this).remove();h()}}else{a(this).css("opacity",1)}}};a(".gradient-stop").draggable(e);var g=2;jQuery(document).on("click",".spectrumbox-gradient",function(o){var j=a(this).offset();var n=o.pageX-j.left;var m="";var l=0;var k=0;var q=f.gradientBoxWidth;var p="empty";a(".gradient-stop").each(function(){k=n-a(this).position().left;if(k<0){k*=-1}if(q>k){q=k;p=a(this).clone()}p.attr("id","gradient-stop-"+g);p.attr("data-id",g);p.children(".gradient-stop-pos").html(Math.ceil(n/widthRatio));p.find(".gradient-stop-pos-input").val(Math.ceil(n/widthRatio));p.css("left",n);l++});g++;p.draggable(e);a(".gradient-stop-control-area ul").append(p);h()});function h(){cssFullText="";cssWrapper="<div class='cssWrapper'>";cssLineWrapper="<div class='cssLineWrapper'>";cssWrapperEnd=cssLineWrapperEnd="</div>";cssOpenBracket="<span class='symbol'>(</span>";cssCloseBracket="<span class='symbol'>)</span>";cssComma="<span class='symbol'>,</span>";cssSemicolon="<span class='symbol'>;</span>";cssPercent="<span class='symbol'>%</span>";cssPrefix="<span class='vendorPrefix'></span>";cssAttribute="<span class='cssAttribute'>background</span><span class='symbol'>:</span> ";cssPieAttribute="<span class='cssAttribute cssPieAttribute'><span class='vendorPrefix'>-pie-</span>background</span>: ";cssAttributeValue="<span class='cssAttributeValue'>";cssAttributeValueEnd="</span>";if(jQuery.browser.mozilla){vendor="moz"}else{if(jQuery.browser.msie){vendor="default"}else{if(jQuery.browser.opera){vendor="o"}else{if(jQuery.browser.webkit||jQuery.browser.safari){vendor="webkit"}else{vendor="default"}}}}cssGradientType="<span class='cssGradientType'>linear-gradient</span>";cssOrientation="<span class='cssOrientation'>left</span>";cssStopValues="<span class='cssStopValues'></span>";if(a("#spectral-cssplaceholder").html()==""){cssFullText+=cssWrapper;cssPreLine=cssAttribute+cssAttributeValue;cssPostLine=cssGradientType+cssOpenBracket+cssOrientation+cssComma+" "+cssStopValues+cssCloseBracket+cssAttributeValueEnd+cssSemicolon;cssFullText+="<div class='cssLineWrapper' id='cssLineWrapper-webkit' data-vendor='webkit'>"+cssPreLine+"<span class='vendorPrefix'>-webkit-</span>"+cssPostLine+"</div>";cssFullText+="<div class='cssLineWrapper' id='cssLineWrapper-moz' data-vendor='moz'>"+cssPreLine+"<span class='vendorPrefix'>-moz-</span>"+cssPostLine+"</div>";cssFullText+="<div class='cssLineWrapper' id='cssLineWrapper-o' data-vendor='o'>"+cssPreLine+"<span class='vendorPrefix'>-o-</span>"+cssPostLine+"</div>";cssFullText+="<div class='cssLineWrapper' id='cssLineWrapper-msie' data-vendor='ms'>"+cssPreLine+"<span class='vendorPrefix'>-ms-</span>"+cssPostLine+"</div>";cssFullText+="<div class='cssLineWrapper' id='cssLineWrapper-default' data-vendor='default'>"+cssPreLine+"<span class='vendorPrefix'></span>"+cssPostLine+"</div>";cssFullText+=cssWrapperEnd;a("#spectral-cssplaceholder").html(cssFullText)}a(".gradient-stop").each(function(){stopColor=a(this).children(".gradient-stop-color").css("background-color");stopLoc=Math.ceil(a(this).position().left/widthRatio);cssStopColor="<span class='cssColor' id='cssColor"+a(this).attr("data-id")+"'>"+stopColor+"</span>";cssStopLoc="<span class='cssPosition' id='cssPos"+a(this).attr("data-id")+"'>"+stopLoc+"</span>"+cssPercent;cssStopValue="<span class='cssStopValue' id='cssStopValue"+a(this).attr("data-id")+"' data-id='"+a(this).attr("data-id")+"' data-pos='"+stopLoc+"'>"+cssStopColor+" "+cssStopLoc+", </span>";if(a("#cssStopValue"+a(this).attr("data-id")).length==0){a(".cssStopValues").append(cssStopValue)}if(a("#cssColor"+a(this).attr("data-id")).length){a(".cssLineWrapper").find("#cssColor"+a(this).attr("data-id")).html(stopColor)}if(a("#cssPos"+a(this).attr("data-id")).length){a(".cssLineWrapper").find("#cssPos"+a(this).attr("data-id")).html(stopLoc)}if(a("#cssStopValue"+a(this).attr("data-id")).length){a(".cssLineWrapper").find("#cssStopValue"+a(this).attr("data-id")).html(cssStopColor+" "+cssStopLoc+", ");a(".cssLineWrapper").find("#cssStopValue"+a(this).attr("data-id")).attr("data-pos",stopLoc)}});a(".cssStopValue").each(function(){if(a("#gradient-stop-"+a(this).attr("data-id")).length==0){a(this).remove()}});if(f.includePie){pieClone=a("#cssLineWrapper-default").clone();pieClone.attr("id","cssLineWrapper-pie");pieClone.children(".cssAttribute").prepend("-pie-");if(a("#cssLineWrapper-pie").length==0){a("#cssLineWrapper-default").before(pieClone)}}webkitClone=a("#cssLineWrapper-webkit").clone();webkitClone.attr("id","cssLineWrapper-oldwebkit");webkitClone.find(".cssGradientType").html("gradient");webkitClone.find(".cssOrientation").html("linear, 0% 50%, 100% 50%");if(a("#cssLineWrapper-oldwebkit").length==0){a("#cssLineWrapper-webkit").before(webkitClone)}a("#cssLineWrapper-oldwebkit").find(".cssStopValue").each(function(){thisColor=a(this).children(".cssColor").html();thisPosition=a(this).children(".cssPosition").html();a(this).html("");if(a("oldWebKit"+a(this).attr("id")).length==0){a(this).prepend("<span class='oldwebkitcolorstop'>color-stop</span>("+thisPosition+"%, "+thisColor+"), ")}a(this).addClass("oldWebKit"+a(this).attr("id"))});a(".cssLineWrapper").each(function(){a(this).find(".cssStopValue").sortElements(function(j,i){return parseInt(a(j).attr("data-pos"))>parseInt(a(i).attr("data-pos"))?1:-1});a(this).find(".cssStopValue").last().html(a(this).find(".cssStopValue").last().html().substring(0,a(this).find(".cssStopValue").last().html().length-2))});a(".spectrumbox-gradient").css("background",a("#cssLineWrapper-"+vendor).children(".cssAttributeValue").text());a("#"+f.targetTextArea).html(a(".cssWrapper").text())}})}})})(jQuery);